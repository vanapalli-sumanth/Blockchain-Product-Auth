{% extends "base.html" %}
{% block title %}Manufacturer Dashboard{% endblock %}

{% block content %}

<div class="container mt-5 mb-5">


<!-- ================= BIG BACKGROUND CARD ================= -->

<div class="card border-0 shadow-lg">

<div class="card-body p-4 p-md-5">



<!-- ================= HEADER ================= -->

<div class="d-flex flex-wrap justify-content-between align-items-center mb-4">

<div>

<h2 class="fw-bold mb-1" style="color:#0b2a6e;">
Manufacturer Dashboard
</h2>

<p class="text-muted mb-0 fs-6">
Manage, monitor, and verify your blockchain-registered products
</p>

</div>


<div class="mt-3 mt-md-0">

<a href="/manufacturer/export-products-excel"
class="btn btn-success me-2">

<i class="fa-solid fa-file-excel me-1"></i>
Export Excel

</a>


<a href="/manufacturer/export-products-pdf"
class="btn btn-danger me-2">

<i class="fa-solid fa-file-pdf me-1"></i>
Export PDF

</a>


<a href="/manufacturer/add-product"
class="btn btn-dark">

<i class="fa-solid fa-plus me-1"></i>
Add Product

</a>

</div>

</div>



<!-- ================= SEARCH + FILTER CARD ================= -->

<div class="card border-0 shadow-sm mb-4">

<div class="card-body">

<div class="row g-3">

<div class="col-md-6">

<label class="form-label fw-semibold">
<i class="fa-solid fa-magnifying-glass me-1"></i>
Search Products
</label>

<input type="text"
id="searchInput"
class="form-control form-control-lg"
placeholder="Search by Product ID, Name, or Tx Hash">

</div>


<div class="col-md-3">

<label class="form-label fw-semibold">
<i class="fa-solid fa-filter me-1"></i>
Filter by Status
</label>

<select id="statusFilter"
class="form-control form-control-lg">

<option value="">All Status</option>
<option value="Registered">Registered</option>

</select>

</div>

</div>

</div>

</div>



<!-- ================= TABLE CARD ================= -->

<div class="card border-0 shadow-sm">

<div class="card-body p-0">

<div class="table-responsive">

<table class="table table-hover align-middle mb-0">

<thead style="background:#0b2a6e;color:white;">

<tr>

<th class="ps-4 py-3">Product ID</th>

<th>Name</th>

<th>Blockchain Tx Hash</th>

<th>Status</th>

<th>Added Date</th>

<th>QR Code</th>

<th class="text-end pe-4">Actions</th>

</tr>

</thead>


<tbody id="productTable">

{% for p in products %}

<tr>

<td class="ps-4 fw-semibold">

{{ p.product_id }}

</td>


<td>

{{ p.name }}

</td>


<td style="max-width:260px;word-break:break-word;font-size:14px;">

{{ p.tx_hash }}

</td>


<td>

<span class="badge bg-success px-3 py-2">

<i class="fa-solid fa-check me-1"></i>
Registered

</span>

</td>


<td>

{{ p.created_at_ist.strftime("%d %b %Y %I:%M %p") }}

</td>


<td>

<img src="{{ url_for('static', filename=p.qr_code) }}"
width="55"
class="border rounded p-1 shadow-sm">

</td>


<td class="text-end pe-4">

<a href="{{ url_for('static', filename=p.qr_code) }}"
download
class="btn btn-sm btn-outline-dark me-1">

<i class="fa-solid fa-download"></i>

</a>


<a href="/manufacturer/product-logs/{{ p.product_id }}"
class="btn btn-sm btn-outline-primary me-1">

<i class="fa-solid fa-clock-rotate-left"></i>

</a>


<button
class="btn btn-sm btn-outline-danger confirm-btn"
data-url="/manufacturer/delete/{{ p.product_id }}"
data-bs-toggle="modal"
data-bs-target="#confirmModal">
<i class="fa-solid fa-trash"></i>
</button>

</td>

</tr>

{% endfor %}

</tbody>

</table>

</div>

</div>

</div>



</div>
</div>
</div>



<script>

const searchInput = document.getElementById("searchInput")
const statusFilter = document.getElementById("statusFilter")

searchInput.addEventListener("keyup", filterTable)
statusFilter.addEventListener("change", filterTable)

function filterTable(){

let search = searchInput.value.toLowerCase()
let status = statusFilter.value.toLowerCase()

let rows = document.querySelectorAll("#productTable tr")

rows.forEach(row=>{

let text = row.innerText.toLowerCase()

let matchesSearch = text.includes(search)
let matchesStatus = status=="" || text.includes(status)

row.style.display =
(matchesSearch && matchesStatus)
? ""
: "none"

})

}

</script>

{% endblock %}